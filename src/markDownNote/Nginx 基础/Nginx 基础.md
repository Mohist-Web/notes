
<div id="export_content"><div class="output_wrapper" id="output_wrapper_id"><h2 id="hnginx"><span>Nginx 基础</span></h2>
<h3 id="h"><span>反向代理</span></h3>
<blockquote>
  <p>当我们有一个服务器集群，并且服务器集群中的每台服务器的内容一样的时候，同样我们要直接从个人电脑访问到服务器集群服务器的时候无法访问，必须通过第三方服务器才能访问集群。<br>这个时候，我们通过第三方服务器访问服务器集群的内容，但是我们并不知道是哪一台服务器提供的内容，此种代理方式称为反向代理。<br>Nginx在做反向代理时，提供性能稳定，并且能够提供配置灵活的转发功能。Nginx可以根据不同的正则匹配，采取不同的转发策略，比如图片文件结尾的走文件服务器，动态页面走web服务器，只要你正则写的没问题，又有相对应的服务器解决方案，你就可以随心所欲的玩。并且Nginx对返回结果进行错误页跳转，异常判断等。如果被分发的服务器存在异常，他可以将请求重新转发给另外一台服务器，然后自动去除异常服务器。</p>
</blockquote>
<h3 id="h-1"><span>负载均衡</span></h3>
<blockquote>
  <p>公司会建立很多的服务器，这些服务器组成了服务器集群，然后，当用户访问网站的时候，先访问一个中间服务器，再让这个中间服务器在服务器集群中选择一个压力较小的服务器，然后将该访问请求引入选择的服务器。<br>所以，用户每次访问，都会保证服务器集群中的每个服务器压力趋于平衡，分担了服务器压力，避免了服务器崩溃的情况。<br>一句话：nginx会给你分配服务器压力小的去访问。Nginx提供的负载均衡策略有2种：内置策略和扩展策略。内置策略为轮询，加权轮询，Ip hash。扩展策略，就天马行空，只有你想不到的没有他做不到的啦。</p>
</blockquote>
<h3 id="hnginx-1"><span>nginx常用命令</span></h3>
<ol>
<li>启动nginx <br>-命令:  nginx</li>
<li>关闭nginx<br>-命令:  nginx -s stop</li>
<li>重启nginx<br>-命令:  nginx -s reload<br>-问题:  重启的时候遇到过报错的问题<br>-解决: 键入“.\nginx”即可</li>
</ol>
<pre><code class="hljs css"><span class="linenum hljs-number">1</span><span class="hljs-selector-tag">nginx</span>&nbsp;:&nbsp;无法将“<span class="hljs-selector-tag">nginx</span>”项识别为&nbsp;<span class="hljs-selector-tag">cmdlet</span>、函数、脚本文件或可运行程序的名称。请检查名称的拼写，如果包括路径，请确保路径正<br><span class="linenum hljs-number">2</span>确，然后再试一次。<br><span class="linenum hljs-number">3</span>所在位置&nbsp;行<span class="hljs-selector-pseudo">:1</span>&nbsp;字符:&nbsp;1<br><span class="linenum hljs-number">4</span>+&nbsp;<span class="hljs-selector-tag">nginx</span>&nbsp;<span class="hljs-selector-tag">-s</span>&nbsp;<span class="hljs-selector-tag">reload</span><br><span class="linenum hljs-number">5</span>+&nbsp;~~~~~<br><span class="linenum hljs-number">6</span>&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span class="hljs-selector-tag">CategoryInfo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span class="hljs-selector-tag">ObjectNotFound</span>:&nbsp;(<span class="hljs-selector-tag">nginx</span><span class="hljs-selector-pseudo">:String)</span>&nbsp;<span class="hljs-selector-attr">[]</span>,&nbsp;<span class="hljs-selector-tag">CommandNotFoundException</span><br><span class="linenum hljs-number">7</span>&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span class="hljs-selector-tag">FullyQualifiedErrorId</span>&nbsp;:&nbsp;<span class="hljs-selector-tag">CommandNotFoundException</span><br></code></pre>
<h3 id="hnginx-2"><span>nginx配置</span></h3>
<pre><code class="hljs nginx"><span class="linenum hljs-number"> 1</span><span class="hljs-comment">#user&nbsp;&nbsp;nobody;&nbsp;#配置用户或者组，默认为nobody&nbsp;nobody</span><br><span class="linenum hljs-number"> 2</span><br><span class="linenum hljs-number"> 3</span><span class="hljs-attribute">worker_processes</span>&nbsp;&nbsp;<span class="hljs-number">1</span>;&nbsp;<span class="hljs-comment">#允许生成的进程数，默认为1</span><br><span class="linenum hljs-number"> 4</span><br><span class="linenum hljs-number"> 5</span><span class="hljs-comment">#error_log&nbsp;&nbsp;logs/error.log;&nbsp;#制定日志路径，级别。这个设置可以放入全局块，http块，server块，级别以此为：debug|info|notice|warn|error|crit|alert|emerg</span><br><span class="linenum hljs-number"> 6</span><br><span class="linenum hljs-number"> 7</span><span class="hljs-comment">#pid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logs/nginx.pid;&nbsp;#指定nginx进程运行文件存放地址</span><br><span class="linenum hljs-number"> 8</span><br><span class="linenum hljs-number"> 9</span><span class="hljs-comment">#events块:&nbsp;配置影响nginx服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等</span><br><span class="linenum hljs-number">10</span><span class="hljs-section">events</span>&nbsp;{<br><span class="linenum hljs-number">11</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">accept_mutex</span>&nbsp;<span class="hljs-literal">on</span>;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#设置网路连接序列化，防止惊群现象发生，默认为on</span><br><span class="linenum hljs-number">12</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">multi_accept</span>&nbsp;<span class="hljs-literal">on</span>;&nbsp;&nbsp;<span class="hljs-comment">#设置一个进程是否同时接受多个网络连接，默认为off</span><br><span class="linenum hljs-number">13</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#use&nbsp;epoll;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport</span><br><span class="linenum hljs-number">14</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">worker_connections</span>&nbsp;&nbsp;<span class="hljs-number">1024</span>;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#最大连接数，默认为512</span><br><span class="linenum hljs-number">15</span>}<br><span class="linenum hljs-number">16</span><br><span class="linenum hljs-number">17</span><span class="hljs-comment">#http块:&nbsp;可以嵌套多个server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，mime-type定义，日志自定义，是否使用sendfile传输文件，连接超时时间，单连接请求数等。</span><br><span class="linenum hljs-number">18</span><span class="hljs-section">http</span>&nbsp;{<br><span class="linenum hljs-number">19</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">include</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mime.types;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#文件扩展名与文件类型映射表</span><br><span class="linenum hljs-number">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">default_type</span>&nbsp;&nbsp;application/octet-stream;&nbsp;<span class="hljs-comment">#默认文件类型，默认为text/plain</span><br><span class="linenum hljs-number">21</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#access_log&nbsp;off;&nbsp;#取消服务日志&nbsp;&nbsp;&nbsp;&nbsp;</span><br><span class="linenum hljs-number">22</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">log_format</span>&nbsp;myFormat&nbsp;<span class="hljs-string">'<span class="hljs-variable">$remote_addr</span>–<span class="hljs-variable">$remote_user</span>&nbsp;[<span class="hljs-variable">$time_local</span>]&nbsp;<span class="hljs-variable">$request</span>&nbsp;<span class="hljs-variable">$status</span>&nbsp;<span class="hljs-variable">$body_bytes_sent</span>&nbsp;<span class="hljs-variable">$http_referer</span>&nbsp;<span class="hljs-variable">$http_user_agent</span>&nbsp;<span class="hljs-variable">$http_x_forwarded_for</span>'</span>;&nbsp;<span class="hljs-comment">#自定义格式</span><br><span class="linenum hljs-number">23</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">access_log</span>&nbsp;log/access.log&nbsp;myFormat;&nbsp;&nbsp;<span class="hljs-comment">#combined为日志格式的默认值</span><br><span class="linenum hljs-number">24</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">sendfile</span>&nbsp;<span class="hljs-literal">on</span>;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。</span><br><span class="linenum hljs-number">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">sendfile_max_chunk</span>&nbsp;<span class="hljs-number">100k</span>;&nbsp;&nbsp;<span class="hljs-comment">#每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。</span><br><span class="linenum hljs-number">26</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">keepalive_timeout</span>&nbsp;<span class="hljs-number">65</span>;&nbsp;&nbsp;<span class="hljs-comment">#连接超时时间，默认为75s，可以在http，server，location块。</span><br><span class="linenum hljs-number">27</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">error_page</span>&nbsp;<span class="hljs-number">404</span>&nbsp;D:\WorkBook\QianKun\serve\dist\<span class="hljs-number">404</span>.html;&nbsp;<span class="hljs-comment">#错误页</span><br><span class="linenum hljs-number">28</span><br><span class="linenum hljs-number">29</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#server块:&nbsp;配置虚拟主机的相关参数，一个http中可以有多个server。</span><br><span class="linenum hljs-number">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-section">server</span>&nbsp;{<br><span class="linenum hljs-number">31</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">keepalive_requests</span>&nbsp;<span class="hljs-number">120</span>;&nbsp;<span class="hljs-comment">#单连接请求上限次数。</span><br><span class="linenum hljs-number">32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">listen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-number">4545</span>;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#监听端口</span><br><span class="linenum hljs-number">33</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">server_name</span>&nbsp;&nbsp;<span class="hljs-number">127.0.0.1</span>;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#监听地址&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br><span class="linenum hljs-number">34</span><br><span class="linenum hljs-number">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#location块:&nbsp;配置请求的路由，以及各种页面的处理情况。</span><br><span class="linenum hljs-number">36</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">location</span>&nbsp;&nbsp;~*^.+$&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#请求的url过滤，正则匹配，~为区分大小写，~*为不区分大小写。</span><br><span class="linenum hljs-number">37</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#root&nbsp;path;&nbsp;&nbsp;#根目录</span><br><span class="linenum hljs-number">38</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#index&nbsp;vv.txt;&nbsp;&nbsp;#设置默认页</span><br><span class="linenum hljs-number">39</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">proxy_pass</span>&nbsp;&nbsp;http://mysvr;&nbsp;&nbsp;<span class="hljs-comment">#请求转向mysvr&nbsp;定义的服务器列表</span><br><span class="linenum hljs-number">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">deny</span>&nbsp;<span class="hljs-number">127.0.0.1</span>;&nbsp;&nbsp;<span class="hljs-comment">#拒绝的ip</span><br><span class="linenum hljs-number">41</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">allow</span>&nbsp;<span class="hljs-number">172.18.5.54</span>;&nbsp;<span class="hljs-comment">#允许的ip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br><span class="linenum hljs-number">42</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br><span class="linenum hljs-number">43</span>&nbsp;&nbsp;&nbsp;&nbsp;}<br><span class="linenum hljs-number">44</span>}<br></code></pre></div></div>
